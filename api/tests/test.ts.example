import { knex } from 'models'
import Person from 'models/person'
import { ValidationError } from 'objection'
import knexCleaner from 'knex-cleaner'

beforeAll(async () => {
  await knex.migrate.latest()
})

beforeEach(async () => {
  await knexCleaner.clean(knex, {
    ignoreTables: ['knex_migrations', 'knex_migrations_lock'],
  })
})

afterAll(async () => {
  await knex.destroy()
})

describe('person insert', () => {
  it('successfully inserts', async () => {
    const person = await Person.query().insertGraph({
      name: 'Brandon',
    })

    expect(person.id).toBeTruthy()
  })
  it('rejects person with empty name', async () => {
    await expect(
      Person.query().insertGraph({
        name: '',
      })
    ).rejects.toThrow(ValidationError)
  })
})
